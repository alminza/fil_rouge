user  nginx;
worker_processes  1;

error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;


events {
    worker_connections  1024;
}



http {
	client_max_body_size 5M;
	sendfile        on;
	keepalive_timeout  65;
	server {
    		listen 80;
    		server_name fil-rouge.vdp.p2021.ajoga.fr;
		location /.well-known/acme-challenge/ {
        	root /var/www/certbot;
                }
		location / {
			proxy_pass http://loadbalancer; 
    	}  
    
	}
	upstream loadbalancer {
        	server 172.31.23.96:5001;
		server 172.31.23.96:5002;
		server 172.31.23.96:5003;
		server 172.31.23.96:5004;
		server 172.31.23.96:5005;
        	}
	server {
		listen 443 ssl;
		server_name fil-rouge.vdp.p2021.ajoga.fr;
		ssl_certificate /etc/letsencrypt/live/fil-rouge.vdp.p2021.ajoga.fr/fullchain.pem;
		ssl_certificate_key /etc/letsencrypt/live/fil-rouge.vdp.p2021.ajoga.fr/privkey.pem;
		include /etc/letsencrypt/options-ssl-nginx.conf;
		ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
		client_body_buffer_size 25M; #Permet de r√©gler la taille du buffer de Nginx
        	client_max_body_size 10M; #Taille maximum des requetes 10MO
		location /{
			proxy_pass http://loadbalancer;
	}
	}
}
